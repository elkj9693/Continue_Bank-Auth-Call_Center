# SSAP (수탁사 - 본인인증 제공자) - 기술 문서
> "신뢰할 수 있는 신원 확인의 표준을 만듭니다."

SSAP(구 V-PASS)는 Continue Bank 생태계 내에서 본인인증 및 연계정보(CI/DI) 생성을 담당하는 핵심 인증 기관 시뮬레이터입니다.

---

## 📋 목차
- [서비스 개요](#🎯-서비스-개요)
- [데이터베이스 구조](#🗄-데이터베이스-구조)
- [인증 메커니즘](#🔑-인증-메커니즘)
- [API 명세서](#📡-api-명세서)
- [보안 정책](#🛡-보안-정책)

---

## 🎯 서비스 개요

SSAP는 가상 통신사 가입자 정보를 기반으로 실시간 본인인증(OTP)을 수행하고, 위탁사의 요청에 따라 일회성 인증 토큰을 발행합니다.

### 핵심 역할
- **신원 확인**: 휴대폰 번호 매칭 및 OTP 발송/검증
- **식별 데이터 생성**: 서비스 간 연계 확인을 위한 CI(연계정보) 및 DI 생성
- **보안 토큰 관리**: 위탁사 전송용 인증 토큰(tokenId) 발행 및 수명 주기 관리
- **감사**: 인증 시도 및 성공/실패 이력 보관

### 서비스 포트
- **백엔드 (Backend)**: 8086
- **프론트엔드 (Frontend)**: 5176

---

## 🗄 데이터베이스 구조

### 1. `auth_token` 테이블 (휘발성)
현재 진행 중인 인증 세션을 관리합니다.
| 컬럼명 | 타입 | 설명 | 보안 비고 |
| :--- | :--- | :--- | :--- |
| `token_id` | UUID | 인증 세션 고유 키 | 프론트엔드 노출용 |
| `name` | VARCHAR | 고객 성명 | **AES-256 암호화** |
| `client_data` | VARCHAR | 휴대폰 번호 | **AES-256 암호화** |
| `otp` | VARCHAR | 6자리 인증 번호 | 평문(MOCK용) |
| `status` | VARCHAR | 진행 상태 | PENDING, COMPLETED, USED |
| `created_at` | DATETIME | 생성 일시 | 3분 후 자동 파기 대상 |

### 2. `mock_carrier_subscriber` 테이블
가상 통신사(SKT, KT, LGU+) 가입자 원장 데이터입니다. (시뮬레이션용)

---

## 🔑 인증 메커니즘

### 1. 인증 토큰 생명 주기
1.  **위탁사 요청**: 위탁사 백엔드가 `/api/v1/auth/init` 호출.
2.  **세션 생성**: 상태가 `PENDING`인 `tokenId` 발급.
3.  **OTP 검증**: 사용자가 OTP 입력 성공 시 상태가 `COMPLETED`로 변경되고 CI가 할당됨.
4.  **토큰 소비**: 위탁사가 결과 조회를 위해 `/api/v1/auth/consume` 호출 시 상태가 `USED`로 변경되며 데이터 반환 후 세션 사실상 종료.

---

## 📡 API 명세서 (기본)

### [내부 시스템용 (S2S)]

#### 1. 인증 초기화 (`POST /api/v1/auth/init`)
- **요청**: 성명, 번호
- **응답**: `tokenId`

#### 2. 인증 소비 (`POST /api/v1/auth/consume/{tokenId}`)
- **요청**: `tokenId`
- **응답**: 검증된 고객 정보 및 CI/DI 반환 (일회성)

### [프론트엔드용]

#### 1. 상태 조회 (`GET /api/v1/auth/status/{tokenId}`)
- **응답**: 현재 세션의 진행 상태 (COMPLETED 여부 등)

#### 2. OTP 발송 (`POST /api/v1/auth/otp/request`)
- **요청**: `tokenId`, 통신사 정보

---

## 🛡 보안 정책

### 1. 데이터 파기 (TTL)
- 모든 인증 세션 데이터는 보안을 위해 생성 3분 후 스케줄러에 의해 자동 삭제됩니다.
- 이미 소비(USED)된 토큰은 즉시 조회가 차단됩니다.

### 2. 개인정보 암호화
- 원장에 저장되는 고객 성명과 연락처는 위탁사와 동일한 AES-256 키 체계를 사용하여 암호화 보관됩니다.

---
**SSAP Identity Provider** - 더 안전한 연결을 위한 시작점. 🔐
